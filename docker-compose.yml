version: '3.8'

services:
  zookeeper:
    image: bitnami/zookeeper:latest
    container_name: zookeeper
    networks:
      - bigdata
    ports:
      - "2181:2181"
    volumes:
      - ./zookeeper_data:/bitnami/zookeeper  

  hadoop-namenode:
    image: bde2020/hadoop-namenode:latest
    container_name: hadoop-namenode
    environment:
      - CLUSTER_NAME=test-cluster
    networks:
      - bigdata
    ports:
      - "9870:9870"  
    depends_on:
      - zookeeper
    volumes:
      - ./hadoop_namenode_data:/hadoop/dfs/name 

  hadoop-datanode:
    image: bde2020/hadoop-datanode:latest
    container_name: hadoop-datanode
    networks:
      - bigdata
    depends_on:
      - hadoop-namenode
    volumes:
      - ./hadoop_datanode_data:/hadoop/dfs/data  

  hbase:
    image: harisekhon/hbase:latest
    container_name: hbase
    networks:
      - bigdata
    ports:
      - "16000:16000"
      - "16010:16010"
      - "16020:16020"
      - "16030:16030"
      - "8080:8080"
      - "9095:9095"
      - "9090:9090"
    depends_on:
      - zookeeper
      - hadoop-namenode

  hive-metastore:
    image: bde2020/hive:latest
    container_name: hive-metastore
    environment:
      - HIVE_METASTORE_HOST=hive-metastore
      - HIVE_METASTORE_PORT=9083
      - POSTGRES_HOST=hive-postgresql
      - POSTGRES_DB=hive
      - POSTGRES_USER=hive
      - POSTGRES_PASSWORD=hive
      - HADOOP_CONF_DIR=/opt/hive/conf
    networks:
      - bigdata
    ports:
      - "9083:9083"
    depends_on:
      - hadoop-namenode
      - zookeeper
      - hbase
      - hive-postgresql

  hive-server:
    image: bde2020/hive:latest
    container_name: hive-server
    environment:
      - SERVICE_NAME=hive-server
      - HIVE_METASTORE_URI=thrift://hive-metastore:9083
    networks:
      - bigdata
    ports:
      - "10000:10000"
    depends_on:
      - hive-metastore

  hive-postgresql:
    image: postgres:latest
    container_name: hive-postgresql
    environment:
      - POSTGRES_USER=hive
      - POSTGRES_PASSWORD=hive
      - POSTGRES_DB=hive
    networks:
      - bigdata
    ports:
      - "5432:5432"

networks:
  bigdata:
    driver: bridge
